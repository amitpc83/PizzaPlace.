@page "/"
@inject IMenuService MenuService
@inject IOrderService OrderService
@rendermode InteractiveServer
<PageTitle>Home</PageTitle>

<!--Menu-->

<PizzaList  ButtonClass="btn btn-success pl-4 pr-4"
            ButtonTitle="Order"
            Items="@State.Menu.Pizzas"
            Title="Our Selection of Pizzas"
            Selected="@AddToBasket"
    ></PizzaList>
<!--End Menu-->
<!--Shopping Basket-->

 <ShoppingBasket Orders="@State.Basket.Orders"
                 GetPizzaFromId="@State.Menu.GetPizza" 
                 Selected="@RemoveFromBasket">
</ShoppingBasket>
 <!--End Shopping Basket-->
<!--Customer Entry-->

<CustomerEntry ButtonClass="mx-auto w-25 btn btn-success" 
               ButtonTitle="Checkout" @bind-Customer="@State.Basket.Customer"
              Title="Please enter your details below" 
              ValidSubmit="PlaceOrder" ></CustomerEntry>

<!--End Customer Entry-->
@State.ToJson()

    @code {
        private State State { get; } = new State();
        private string SpicinessImage(Spiciness spiciness) => $"images/{spiciness.ToString().ToLower()}.png";
        private void AddToBasket(Pizza pizza) => State.Basket.Add(pizza.Id);
        private void RemoveFromBasket(int pos) => State.Basket.RemoveAt(pos);
        private async Task PlaceOrder(){
            await OrderService.PlaceOrder(State.Basket);
        }
        protected override async Task OnInitializedAsync()
        {
            Menu menu = await MenuService.GetMenuAsync();
            foreach(Pizza pizza in menu.Pizzas){
                State.Menu.Pizzas.Add(pizza);
            }            
        }
    }
